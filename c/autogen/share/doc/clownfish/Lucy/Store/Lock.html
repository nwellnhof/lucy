<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<!--
***********************************************

!!!! DO NOT EDIT !!!!

This file was auto-generated by cfc.

***********************************************

Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to You under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<meta name="viewport" content="width=device-width" />
<title>Lucy::Store::Lock – C API Documentation</title>
<style type="text/css">
body {
    max-width: 48em;
    font: 0.85em/1.4 sans-serif;
}
a {
    color: #23b;
}
table {
    border-collapse: collapse;
}
td {
    padding: 0;
}
td.label {
    padding-right: 2em;
    font-weight: bold;
}
dt {
    font-weight: bold;
}
pre {
    border: 1px solid #ccc;
    padding: 0.2em 0.4em;
    background: #f6f6f6;
    font-size: 0.92em;
}
pre a {
    text-decoration: none;
}
pre, code {
    font-family: "Consolas", "Menlo", monospace;
}
span.prefix, span.comment {
    color: #888;
}
</style>
</head>
<body>
<h1>Lucy::Store::Lock</h1>
<table>
<tr>
<td class="label">parcel</td>
<td><a href="../../lucy.html">Lucy</a></td>
</tr>
<tr>
<td class="label">class variable</td>
<td><code><span class="prefix">LUCY_</span>LOCK</code></td>
</tr>
<tr>
<td class="label">struct symbol</td>
<td><code><span class="prefix">lucy_</span>Lock</code></td>
</tr>
<tr>
<td class="label">class nickname</td>
<td><code><span class="prefix">lucy_</span>Lock</code></td>
</tr>
<tr>
<td class="label">header file</td>
<td><code>Lucy/Store/Lock.h</code></td>
</tr>
</table>
<h2>Name</h2>
<p>Lucy::Store::Lock – Abstract class representing an interprocess mutex lock.</p>
<h2>Description</h2>
<p>The Lock class produces an interprocess mutex lock.  The default subclass
uses dot-lock files, but alternative implementations are possible.</p>
<p>Each lock must have a name which is unique per resource to be locked.  Each
lock also has a “host” id which should be unique per machine; it is used to
help clear away stale locks.</p>
<h2>Functions</h2>
<dl>
<dt id="func_init">init</dt>
<dd>
<pre><code><span class="prefix">lucy_</span>Lock*
<span class="prefix">lucy_</span><strong>Lock_init</strong>(
    <span class="prefix">lucy_</span>Lock *<strong>self</strong>,
    <span class="prefix">lucy_</span><a href="../../Lucy/Store/Folder.html">Folder</a> *<strong>folder</strong>,
    <span class="prefix">cfish_</span><a href="../../Clownfish/String.html">String</a> *<strong>name</strong>,
    <span class="prefix">cfish_</span><a href="../../Clownfish/String.html">String</a> *<strong>host</strong>,
    int32_t <strong>timeout</strong>,
    int32_t <strong>interval</strong>
);
</code></pre>
<p>Abstract initializer.</p>
<dl>
<dt>folder</dt>
<dd><p>A Folder.</p>
</dd>
<dt>name</dt>
<dd><p>String identifying the resource to be locked, which must
consist solely of characters matching [-_.A-Za-z0-9].</p>
</dd>
<dt>host</dt>
<dd><p>A unique per-machine identifier.</p>
</dd>
<dt>timeout</dt>
<dd><p>Time in milliseconds to keep retrying before abandoning
the attempt to <a href="../../Lucy/Store/Lock.html#func_Obtain">Obtain()</a> a lock.</p>
</dd>
<dt>interval</dt>
<dd><p>Time in milliseconds between retries.</p>
</dd>
</dl>
</dd>
</dl>
<h2>Methods</h2>
<dl>
<dt id="func_Shared">Shared <span class="comment">(abstract)</span></dt>
<dd>
<pre><code>bool
<span class="prefix">lucy_</span><strong>Lock_Shared</strong>(
    <span class="prefix">lucy_</span>Lock *<strong>self</strong>
);
</code></pre>
<p>Returns true if the Lock is shared, false if the Lock is exclusive.</p>
</dd>
<dt id="func_Obtain">Obtain</dt>
<dd>
<pre><code>bool
<span class="prefix">lucy_</span><strong>Lock_Obtain</strong>(
    <span class="prefix">lucy_</span>Lock *<strong>self</strong>
);
</code></pre>
<p>Call <a href="../../Lucy/Store/Lock.html#func_Request">Request()</a> once per <code>interval</code> until <a href="../../Lucy/Store/Lock.html#func_Request">Request()</a> returns
success or the <code>timeout</code> has been reached.</p>
<p><strong>Returns:</strong> true on success, false on failure (sets the global error object
returned by <a href="../../Clownfish/Err.html#func_get_error">get_error()</a>).</p>
</dd>
<dt id="func_Request">Request <span class="comment">(abstract)</span></dt>
<dd>
<pre><code>bool
<span class="prefix">lucy_</span><strong>Lock_Request</strong>(
    <span class="prefix">lucy_</span>Lock *<strong>self</strong>
);
</code></pre>
<p>Make one attempt to acquire the lock.</p>
<p>The semantics of <a href="../../Lucy/Store/Lock.html#func_Request">Request()</a> differ depending on whether <a href="../../Lucy/Store/Lock.html#func_Shared">Shared()</a> returns
true.  If the Lock is <a href="../../Lucy/Store/Lock.html#func_Shared">Shared()</a>, then <a href="../../Lucy/Store/Lock.html#func_Request">Request()</a> should not fail if
another lock is held against the resource identified by
<code>name</code> (though it might fail for other reasons).  If it is
not <a href="../../Lucy/Store/Lock.html#func_Shared">Shared()</a> – i.e. it’s an exclusive (write) lock – then other locks
should cause <a href="../../Lucy/Store/Lock.html#func_Request">Request()</a> to fail.</p>
<p><strong>Returns:</strong> true on success, false on failure (sets the global error object
returned by <a href="../../Clownfish/Err.html#func_get_error">get_error()</a>).</p>
</dd>
<dt id="func_Release">Release <span class="comment">(abstract)</span></dt>
<dd>
<pre><code>void
<span class="prefix">lucy_</span><strong>Lock_Release</strong>(
    <span class="prefix">lucy_</span>Lock *<strong>self</strong>
);
</code></pre>
<p>Release the lock.</p>
</dd>
<dt id="func_Is_Locked">Is_Locked <span class="comment">(abstract)</span></dt>
<dd>
<pre><code>bool
<span class="prefix">lucy_</span><strong>Lock_Is_Locked</strong>(
    <span class="prefix">lucy_</span>Lock *<strong>self</strong>
);
</code></pre>
<p>Indicate whether the resource identified by this lock’s name is
currently locked.</p>
<p><strong>Returns:</strong> true if the resource is locked, false otherwise.</p>
</dd>
<dt id="func_Clear_Stale">Clear_Stale <span class="comment">(abstract)</span></dt>
<dd>
<pre><code>void
<span class="prefix">lucy_</span><strong>Lock_Clear_Stale</strong>(
    <span class="prefix">lucy_</span>Lock *<strong>self</strong>
);
</code></pre>
<p>Release all locks that meet the following three conditions: the lock
name matches, the host id matches, and the process id that the lock
was created under no longer identifies an active process.</p>
</dd>
<dt id="func_Destroy">Destroy</dt>
<dd>
<pre><code>void
<span class="prefix">lucy_</span><strong>Lock_Destroy</strong>(
    <span class="prefix">lucy_</span>Lock *<strong>self</strong>
);
</code></pre>
<p>Generic destructor.  Frees the struct itself but not any complex
member elements.</p>
</dd>
</dl>
<h2>Inheritance</h2>
<p>Lucy::Store::Lock is a <a href="../../Clownfish/Obj.html">Clownfish::Obj</a>.</p>
</body>
</html>
